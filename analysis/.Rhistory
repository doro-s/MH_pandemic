install.packages('tidyverse')
library(tidyverse)
library(tidyverse)
read_csv('D:MH_pandemic\output\input_cis_vl.csv')
library(tidyverse)
read_csv('D:\\MH_pandemic\\output\\input_cis_vl.csv')
library(tidyverse)
cis_wide <- read_csv('D:\\MH_pandemic\\output\\input_cis_vl.csv')
View(cis_wide)
str(cis_wide)
colnames(cis_wide)
cis_long <- cis_wide %>%
select(patient_id, matches('cis\\_visit\\_date\\d+'))
View(cis_long)
cis_long <- cis_wide %>%
select(patient_id, matches('cis\\_visit\\_date\\_\\d+'))
View(cis_long)
cis_long <- cis_wide %>%
select(patient_id, matches('cis\\_visit\\_date\\_\\d+')) %>%
pivot_longer(cols = -patient_id,
names_to = c(NA, 'cis_visit_date'),
names_pattern = '^(.*)_(\\d+)',
values_to = 'visit_date',
values_drop_na = TRUE) %>%
arrange(patient_id, date)
cis_long <- cis_wide %>%
select(patient_id, matches('cis\\_visit\\_date\\_\\d+')) %>%
pivot_longer(cols = -patient_id,
names_to = c(NA, 'cis_visit_date'),
names_pattern = '^(.*)_(\\d+)',
values_to = 'visit_date',
values_drop_na = TRUE)
View(cis_long)
cis_long <- cis_wide %>%
select(patient_id, matches('cis\\_visit\\_date\\_\\d+')) %>%
pivot_longer(cols = -patient_id,
names_to = c(NA, 'cis_visit_date'),
names_pattern = '^(.*)_(\\d+)',
values_to = 'visit_date',
values_drop_na = TRUE) %>%
arrange(patient_id, visit_date)
library(tidyverse)
cis_wide <- read_csv('D:\\MH_pandemic\\output\\input_cis_vl.csv')
cis_long <- cis_wide %>%
select(patient_id, matches('cis\\_visit\\_date\\_\\d+')) %>%
pivot_longer(cols = -patient_id,
names_to = c(NA, 'visit_number'),
names_pattern = '^(.*)_(\\d+)',
values_to = 'visit_date',
values_drop_na = TRUE) %>%
arrange(patient_id, visit_number)
View(cis_long)
library(tidyverse)
cis_wide <- read_csv('D:\\MH_pandemic\\output\\input_cis_vl.csv')
cis_long <- cis_wide %>%
select(patient_id, matches('cis\\_visit\\_date\\_\\d+')) %>%
pivot_longer(cols = -patient_id,
names_to = c(NA, 'visit_number'),
names_pattern = '^(.*)_(\\d+)',
values_to = 'visit_date',
values_drop_na = TRUE) %>%
arrange(patient_id, visit_number)
write_csv(cis_long, 'D:\\MH_pandemic\\output\\cis_long.csv')
library(tidyverse)
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
cis_wide <- read_csv('../output/input_cis_wide.csv')
wide_to_long <- function(df_wide, col, regex){
df_long <- cis_wide %>%
select(patient_id, matches(regex)) %>%
pivot_longer(cols = -patient_id,
names_to = c(NA, 'visit_number'),
names_pattern = '^(.*)_(\\d+)',
values_to = col,
values_drop_na = TRUE) %>%
mutate(visit_number = as.numeric(visit_number)) %>%
arrange(patient_id, visit_number)
return(df_long)
}
test <- wide_to_long(cis_wide, 'visit_date', 'visit\\_date\\_\\d+')
visit_date <- cis_wide %>%
select(patient_id, matches('visit\\_date\\_\\d+')) %>%
pivot_longer(cols = -patient_id,
names_to = c(NA, 'visit_number'),
names_pattern = '^(.*)_(\\d+)',
values_to = 'visit_date',
values_drop_na = TRUE) %>%
mutate(visit_number = as.numeric(visit_number)) %>%
arrange(patient_id, visit_number)
View(test)
result_mk <- wide_to_long(cis_wide, 'visit_date', 'result\\_mk\\_\\d+')
View(result_mk)
colnames(cis_wide)
visit_date <- wide_to_long(cis_wide, 'visit_date', 'visit\\_date\\_\\d+')
result_mk <- wide_to_long(cis_wide, 'result_mk', 'result\\_mk\\_\\d+')
covid_hes <- wide_to_long(cis_wide, 'covid_hes', 'covid\\_hes\\_\\d+')
covid_tt <- wide_to_long(cis_wide, 'covid_tt', 'covid\\_tt\\_\\d+')
covid_vaccine <- wide_to_long(cis_wide, 'covid_vaccine', 'covid\\_vaccine\\_\\d+')
library(tidyverse)
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
cis_wide <- read_csv('../output/input_cis_wide.csv')
wide_to_long <- function(df_wide, col, regex){
df_long <- cis_wide %>%
select(patient_id, matches(regex)) %>%
pivot_longer(cols = -patient_id,
names_to = c(NA, 'visit_number'),
names_pattern = '^(.*)_(\\d+)',
values_to = col,
values_drop_na = TRUE) %>%
mutate(visit_number = as.numeric(visit_number)) %>%
arrange(patient_id, visit_number)
return(df_long)
}
visit_date <- wide_to_long(cis_wide, 'visit_date', 'visit\\_date\\_\\d+')
result_mk <- wide_to_long(cis_wide, 'result_mk', 'result\\_mk\\_\\d+')
covid_hes <- wide_to_long(cis_wide, 'covid_hes', 'covid\\_hes\\_\\d+')
covid_tt <- wide_to_long(cis_wide, 'covid_tt', 'covid\\_tt\\_\\d+')
covid_vaccine <- wide_to_long(cis_wide, 'covid_vaccine', 'covid\\_vaccine\\_\\d+')
alcohol <- wide_to_long(cis_wide, 'alcohol', 'alcohol\\_\\d+')
cancer <- wide_to_long(cis_wide, 'cancer', 'cancer\\_\\d+')
CVD_ctv3 <- wide_to_long(cis_wide, 'CVD_ctv3', 'CVD\\_ctv3\\_\\d+')
CVD_snomed <- wide_to_long(cis_wide, 'CVD_snomed', 'CVD\\_snomed\\_\\d+')
digestive_disorder <- wide_to_long(cis_wide, 'digestive_disorder', 'digestive\\_disorder\\_\\d+')
hiv_aids <- wide_to_long(cis_wide, 'hiv_aids', 'hiv\\_aid\\_s\\d+')
mental_disorder <- wide_to_long(cis_wide, 'mental_disorder', 'mental\\_disorder\\_\\d+')
metabolic_disorder <- wide_to_long(cis_wide, 'metabolic_disorder', 'metabolic\\_disorder\\_\\d+')
musculoskeletal_ctv3 <- wide_to_long(cis_wide, 'musculoskeletal_ctv3', 'musculoskeletal\\_ctv3\\_\\d+')
musculoskeletal_snomed <- wide_to_long(cis_wide, 'musculoskeletal_snomed', 'musculoskeletal\\_snomed\\_\\d+')
neurological_ctv3 <- wide_to_long(cis_wide, 'neurological_ctv3', 'neurological\\_ctv3\\_\\d+')
neurological_snomed <- wide_to_long(cis_wide, 'neurological_snomed', 'neurological\_snomed\\_\\d+')
kidney_disorder <- wide_to_long(cis_wide, 'kidney_disorder', 'kidney\\_disorder\\_\\d+')
respiratory_disorder <- wide_to_long(cis_wide, 'respiratory_disorder', 'respiratory\\_disorder\\_\\d+')
cis_long <- visit_date %>%
left_join(result_mk, by = c('patient_id', 'visit_number'))
# Join everything together
cis_long <- visit_date %>%
left_join(result_mk, by = c('patient_id', 'visit_number')) %>%
left_join(covid_hes, by = c('patient_id', 'visit_number')) %>%
left_join(covid_tt, by = c('patient_id', 'visit_number')) %>%
left_join(covid_vaccine, by = c('patient_id', 'visit_number'))
View(cis_long)
# Join everything together
cis_long <- visit_date %>%
left_join(result_mk, by = c('patient_id', 'visit_number')) %>%
left_join(covid_hes, by = c('patient_id', 'visit_number')) %>%
left_join(covid_tt, by = c('patient_id', 'visit_number')) %>%
left_join(covid_vaccine, by = c('patient_id', 'visit_number')) %>%
left_join(alcohol, by = c('patient_id', 'visit_number')) %>%
left_join(cancer, by = c('patient_id', 'visit_number')) %>%
left_join(CVD_ctv3, by = c('patient_id', 'visit_number')) %>%
left_join(CVD_snomed, by = c('patient_id', 'visit_number')) %>%
left_join(digestive_disorder, by = c('patient_id', 'visit_number')) %>%
left_join(hiv_aids, by = c('patient_id', 'visit_number')) %>%
left_join(mental_disorder, by = c('patient_id', 'visit_number')) %>%
left_join(metabolic_disorder, by = c('patient_id', 'visit_number')) %>%
left_join(musculoskeletal_ctv3, by = c('patient_id', 'visit_number')) %>%
left_join(musculoskeletal_snomed, by = c('patient_id', 'visit_number')) %>%
left_join(neurological_ctv3, by = c('patient_id', 'visit_number')) %>%
left_join(neurological_snomed, by = c('patient_id', 'visit_number')) %>%
left_join(kidney_disorder, by = c('patient_id', 'visit_number')) %>%
left_join(respiratory_disorder, by = c('patient_id', 'visit_number'))
library(tidyverse)
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
cis_wide <- read_csv('../output/input_cis_wide.csv')
wide_to_long <- function(df_wide, col, regex){
df_long <- cis_wide %>%
select(patient_id, matches(regex)) %>%
pivot_longer(cols = -patient_id,
names_to = c(NA, 'visit_number'),
names_pattern = '^(.*)_(\\d+)',
values_to = col,
values_drop_na = TRUE) %>%
mutate(visit_number = as.numeric(visit_number)) %>%
arrange(patient_id, visit_number)
return(df_long)
}
visit_date <- wide_to_long(cis_wide, 'visit_date', 'visit\\_date\\_\\d+')
result_mk <- wide_to_long(cis_wide, 'result_mk', 'result\\_mk\\_\\d+')
covid_hes <- wide_to_long(cis_wide, 'covid_hes', 'covid\\_hes\\_\\d+')
covid_tt <- wide_to_long(cis_wide, 'covid_tt', 'covid\\_tt\\_\\d+')
covid_vaccine <- wide_to_long(cis_wide, 'covid_vaccine', 'covid\\_vaccine\\_\\d+')
alcohol <- wide_to_long(cis_wide, 'alcohol', 'alcohol\\_\\d+')
cancer <- wide_to_long(cis_wide, 'cancer', 'cancer\\_\\d+')
CVD_ctv3 <- wide_to_long(cis_wide, 'CVD_ctv3', 'CVD\\_ctv3\\_\\d+')
CVD_snomed <- wide_to_long(cis_wide, 'CVD_snomed', 'CVD\\_snomed\\_\\d+')
digestive_disorder <- wide_to_long(cis_wide, 'digestive_disorder', 'digestive\\_disorder\\_\\d+')
hiv_aids <- wide_to_long(cis_wide, 'hiv_aids', 'hiv\\_aids\\_\\d+')
mental_disorder <- wide_to_long(cis_wide, 'mental_disorder', 'mental\\_disorder\\_\\d+')
metabolic_disorder <- wide_to_long(cis_wide, 'metabolic_disorder', 'metabolic\\_disorder\\_\\d+')
musculoskeletal_ctv3 <- wide_to_long(cis_wide, 'musculoskeletal_ctv3', 'musculoskeletal\\_ctv3\\_\\d+')
musculoskeletal_snomed <- wide_to_long(cis_wide, 'musculoskeletal_snomed', 'musculoskeletal\\_snomed\\_\\d+')
neurological_ctv3 <- wide_to_long(cis_wide, 'neurological_ctv3', 'neurological\\_ctv3\\_\\d+')
neurological_snomed <- wide_to_long(cis_wide, 'neurological_snomed', 'neurological\_snomed\\_\\d+')
kidney_disorder <- wide_to_long(cis_wide, 'kidney_disorder', 'kidney\\_disorder\\_\\d+')
respiratory_disorder <- wide_to_long(cis_wide, 'respiratory_disorder', 'respiratory\\_disorder\\_\\d+')
# Join everything together
cis_long <- visit_date %>%
left_join(result_mk, by = c('patient_id', 'visit_number')) %>%
left_join(covid_hes, by = c('patient_id', 'visit_number')) %>%
left_join(covid_tt, by = c('patient_id', 'visit_number')) %>%
left_join(covid_vaccine, by = c('patient_id', 'visit_number')) %>%
left_join(alcohol, by = c('patient_id', 'visit_number')) %>%
left_join(cancer, by = c('patient_id', 'visit_number')) %>%
left_join(CVD_ctv3, by = c('patient_id', 'visit_number')) %>%
left_join(CVD_snomed, by = c('patient_id', 'visit_number')) %>%
left_join(digestive_disorder, by = c('patient_id', 'visit_number')) %>%
left_join(hiv_aids, by = c('patient_id', 'visit_number')) %>%
left_join(mental_disorder, by = c('patient_id', 'visit_number')) %>%
left_join(metabolic_disorder, by = c('patient_id', 'visit_number')) %>%
left_join(musculoskeletal_ctv3, by = c('patient_id', 'visit_number')) %>%
left_join(musculoskeletal_snomed, by = c('patient_id', 'visit_number')) %>%
left_join(neurological_ctv3, by = c('patient_id', 'visit_number')) %>%
left_join(neurological_snomed, by = c('patient_id', 'visit_number')) %>%
left_join(kidney_disorder, by = c('patient_id', 'visit_number')) %>%
left_join(respiratory_disorder, by = c('patient_id', 'visit_number'))
library(tidyverse)
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
cis_wide <- read_csv('../output/input_cis_wide.csv')
wide_to_long <- function(df_wide, col, regex){
df_long <- cis_wide %>%
select(patient_id, matches(regex)) %>%
pivot_longer(cols = -patient_id,
names_to = c(NA, 'visit_number'),
names_pattern = '^(.*)_(\\d+)',
values_to = col,
values_drop_na = TRUE) %>%
mutate(visit_number = as.numeric(visit_number)) %>%
arrange(patient_id, visit_number)
return(df_long)
}
visit_date <- wide_to_long(cis_wide, 'visit_date', 'visit\\_date\\_\\d+')
result_mk <- wide_to_long(cis_wide, 'result_mk', 'result\\_mk\\_\\d+')
covid_hes <- wide_to_long(cis_wide, 'covid_hes', 'covid\\_hes\\_\\d+')
covid_tt <- wide_to_long(cis_wide, 'covid_tt', 'covid\\_tt\\_\\d+')
covid_vaccine <- wide_to_long(cis_wide, 'covid_vaccine', 'covid\\_vaccine\\_\\d+')
alcohol <- wide_to_long(cis_wide, 'alcohol', 'alcohol\\_\\d+')
cancer <- wide_to_long(cis_wide, 'cancer', 'cancer\\_\\d+')
CVD_ctv3 <- wide_to_long(cis_wide, 'CVD_ctv3', 'CVD\\_ctv3\\_\\d+')
CVD_snomed <- wide_to_long(cis_wide, 'CVD_snomed', 'CVD\\_snomed\\_\\d+')
digestive_disorder <- wide_to_long(cis_wide, 'digestive_disorder', 'digestive\\_disorder\\_\\d+')
hiv_aids <- wide_to_long(cis_wide, 'hiv_aids', 'hiv\\_aids\\_\\d+')
mental_disorder <- wide_to_long(cis_wide, 'mental_disorder', 'mental\\_disorder\\_\\d+')
metabolic_disorder <- wide_to_long(cis_wide, 'metabolic_disorder', 'metabolic\\_disorder\\_\\d+')
musculoskeletal_ctv3 <- wide_to_long(cis_wide, 'musculoskeletal_ctv3', 'musculoskeletal\\_ctv3\\_\\d+')
musculoskeletal_snomed <- wide_to_long(cis_wide, 'musculoskeletal_snomed', 'musculoskeletal\\_snomed\\_\\d+')
neurological_ctv3 <- wide_to_long(cis_wide, 'neurological_ctv3', 'neurological\\_ctv3\\_\\d+')
neurological_snomed <- wide_to_long(cis_wide, 'neurological_snomed', 'neurological\\_snomed\\_\\d+')
kidney_disorder <- wide_to_long(cis_wide, 'kidney_disorder', 'kidney\\_disorder\\_\\d+')
respiratory_disorder <- wide_to_long(cis_wide, 'respiratory_disorder', 'respiratory\\_disorder\\_\\d+')
# Join everything together
cis_long <- visit_date %>%
left_join(result_mk, by = c('patient_id', 'visit_number')) %>%
left_join(covid_hes, by = c('patient_id', 'visit_number')) %>%
left_join(covid_tt, by = c('patient_id', 'visit_number')) %>%
left_join(covid_vaccine, by = c('patient_id', 'visit_number')) %>%
left_join(alcohol, by = c('patient_id', 'visit_number')) %>%
left_join(cancer, by = c('patient_id', 'visit_number')) %>%
left_join(CVD_ctv3, by = c('patient_id', 'visit_number')) %>%
left_join(CVD_snomed, by = c('patient_id', 'visit_number')) %>%
left_join(digestive_disorder, by = c('patient_id', 'visit_number')) %>%
left_join(hiv_aids, by = c('patient_id', 'visit_number')) %>%
left_join(mental_disorder, by = c('patient_id', 'visit_number')) %>%
left_join(metabolic_disorder, by = c('patient_id', 'visit_number')) %>%
left_join(musculoskeletal_ctv3, by = c('patient_id', 'visit_number')) %>%
left_join(musculoskeletal_snomed, by = c('patient_id', 'visit_number')) %>%
left_join(neurological_ctv3, by = c('patient_id', 'visit_number')) %>%
left_join(neurological_snomed, by = c('patient_id', 'visit_number')) %>%
left_join(kidney_disorder, by = c('patient_id', 'visit_number')) %>%
left_join(respiratory_disorder, by = c('patient_id', 'visit_number'))
# TODO
# Put in sense check to remove rows where visit dates are not monotonically
# increasing
# Shouldn't be a problem in the real data but will affect pipeline devlopment
# write_csv(cis_long, 'output/input_cis_long.csv')
library(tidyverse)
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
cis_wide <- read_csv('../output/input_cis_wide.csv')
wide_to_long <- function(df_wide, col, regex){
df_long <- cis_wide %>%
select(patient_id, matches(regex)) %>%
pivot_longer(cols = -patient_id,
names_to = c(NA, 'visit_number'),
names_pattern = '^(.*)_(\\d+)',
values_to = col,
values_drop_na = TRUE) %>%
mutate(visit_number = as.numeric(visit_number)) %>%
arrange(patient_id, visit_number)
return(df_long)
}
visit_date <- wide_to_long(cis_wide, 'visit_date', 'visit\\_date\\_\\d+')
result_mk <- wide_to_long(cis_wide, 'result_mk', 'result\\_mk\\_\\d+')
covid_hes <- wide_to_long(cis_wide, 'covid_hes', 'covid\\_hes\\_\\d+')
covid_tt <- wide_to_long(cis_wide, 'covid_tt', 'covid\\_tt\\_\\d+')
covid_vaccine <- wide_to_long(cis_wide, 'covid_vaccine', 'covid\\_vaccine\\_\\d+')
alcohol <- wide_to_long(cis_wide, 'alcohol', 'alcohol\\_\\d+')
cancer <- wide_to_long(cis_wide, 'cancer', 'cancer\\_\\d+')
CVD_ctv3 <- wide_to_long(cis_wide, 'CVD_ctv3', 'CVD\\_ctv3\\_\\d+')
CVD_snomed <- wide_to_long(cis_wide, 'CVD_snomed', 'CVD\\_snomed\\_\\d+')
digestive_disorder <- wide_to_long(cis_wide, 'digestive_disorder', 'digestive\\_disorder\\_\\d+')
hiv_aids <- wide_to_long(cis_wide, 'hiv_aids', 'hiv\\_aids\\_\\d+')
mental_disorder <- wide_to_long(cis_wide, 'mental_disorder', 'mental\\_disorder\\_\\d+')
metabolic_disorder <- wide_to_long(cis_wide, 'metabolic_disorder', 'metabolic\\_disorder\\_\\d+')
musculoskeletal_ctv3 <- wide_to_long(cis_wide, 'musculoskeletal_ctv3', 'musculoskeletal\\_ctv3\\_\\d+')
musculoskeletal_snomed <- wide_to_long(cis_wide, 'musculoskeletal_snomed', 'musculoskeletal\\_snomed\\_\\d+')
neurological_ctv3 <- wide_to_long(cis_wide, 'neurological_ctv3', 'neurological\\_ctv3\\_\\d+')
neurological_snomed <- wide_to_long(cis_wide, 'neurological_snomed', 'neurological\\_snomed\\_\\d+')
kidney_disorder <- wide_to_long(cis_wide, 'kidney_disorder', 'kidney\\_disorder\\_\\d+')
respiratory_disorder <- wide_to_long(cis_wide, 'respiratory_disorder', 'respiratory\\_disorder\\_\\d+')
# Join everything together
cis_long <- visit_date %>%
left_join(result_mk, by = c('patient_id', 'visit_number')) %>%
left_join(covid_hes, by = c('patient_id', 'visit_number')) %>%
left_join(covid_tt, by = c('patient_id', 'visit_number')) %>%
left_join(covid_vaccine, by = c('patient_id', 'visit_number')) %>%
left_join(alcohol, by = c('patient_id', 'visit_number')) %>%
left_join(cancer, by = c('patient_id', 'visit_number')) %>%
left_join(CVD_ctv3, by = c('patient_id', 'visit_number')) %>%
left_join(CVD_snomed, by = c('patient_id', 'visit_number')) %>%
left_join(digestive_disorder, by = c('patient_id', 'visit_number')) %>%
left_join(hiv_aids, by = c('patient_id', 'visit_number')) %>%
left_join(mental_disorder, by = c('patient_id', 'visit_number')) %>%
left_join(metabolic_disorder, by = c('patient_id', 'visit_number')) %>%
left_join(musculoskeletal_ctv3, by = c('patient_id', 'visit_number')) %>%
left_join(musculoskeletal_snomed, by = c('patient_id', 'visit_number')) %>%
left_join(neurological_ctv3, by = c('patient_id', 'visit_number')) %>%
left_join(neurological_snomed, by = c('patient_id', 'visit_number')) %>%
left_join(kidney_disorder, by = c('patient_id', 'visit_number')) %>%
left_join(respiratory_disorder, by = c('patient_id', 'visit_number'))
# TODO
# Put in sense check to remove rows where visit dates are not monotonically
# increasing
# Shouldn't be a problem in the real data but will affect pipeline devlopment
write_csv(cis_long, 'output/input_cis_long.csv')
library(tidyverse)
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
cis_wide <- read_csv('../output/input_cis_wide.csv')
wide_to_long <- function(df_wide, col, regex){
df_long <- cis_wide %>%
select(patient_id, matches(regex)) %>%
pivot_longer(cols = -patient_id,
names_to = c(NA, 'visit_number'),
names_pattern = '^(.*)_(\\d+)',
values_to = col,
values_drop_na = TRUE) %>%
mutate(visit_number = as.numeric(visit_number)) %>%
arrange(patient_id, visit_number)
return(df_long)
}
visit_date <- wide_to_long(cis_wide, 'visit_date', 'visit\\_date\\_\\d+')
result_mk <- wide_to_long(cis_wide, 'result_mk', 'result\\_mk\\_\\d+')
covid_hes <- wide_to_long(cis_wide, 'covid_hes', 'covid\\_hes\\_\\d+')
covid_tt <- wide_to_long(cis_wide, 'covid_tt', 'covid\\_tt\\_\\d+')
covid_vaccine <- wide_to_long(cis_wide, 'covid_vaccine', 'covid\\_vaccine\\_\\d+')
alcohol <- wide_to_long(cis_wide, 'alcohol', 'alcohol\\_\\d+')
cancer <- wide_to_long(cis_wide, 'cancer', 'cancer\\_\\d+')
CVD_ctv3 <- wide_to_long(cis_wide, 'CVD_ctv3', 'CVD\\_ctv3\\_\\d+')
CVD_snomed <- wide_to_long(cis_wide, 'CVD_snomed', 'CVD\\_snomed\\_\\d+')
digestive_disorder <- wide_to_long(cis_wide, 'digestive_disorder', 'digestive\\_disorder\\_\\d+')
hiv_aids <- wide_to_long(cis_wide, 'hiv_aids', 'hiv\\_aids\\_\\d+')
mental_disorder <- wide_to_long(cis_wide, 'mental_disorder', 'mental\\_disorder\\_\\d+')
metabolic_disorder <- wide_to_long(cis_wide, 'metabolic_disorder', 'metabolic\\_disorder\\_\\d+')
musculoskeletal_ctv3 <- wide_to_long(cis_wide, 'musculoskeletal_ctv3', 'musculoskeletal\\_ctv3\\_\\d+')
musculoskeletal_snomed <- wide_to_long(cis_wide, 'musculoskeletal_snomed', 'musculoskeletal\\_snomed\\_\\d+')
neurological_ctv3 <- wide_to_long(cis_wide, 'neurological_ctv3', 'neurological\\_ctv3\\_\\d+')
neurological_snomed <- wide_to_long(cis_wide, 'neurological_snomed', 'neurological\\_snomed\\_\\d+')
kidney_disorder <- wide_to_long(cis_wide, 'kidney_disorder', 'kidney\\_disorder\\_\\d+')
respiratory_disorder <- wide_to_long(cis_wide, 'respiratory_disorder', 'respiratory\\_disorder\\_\\d+')
# Join everything together
cis_long <- visit_date %>%
left_join(result_mk, by = c('patient_id', 'visit_number')) %>%
left_join(covid_hes, by = c('patient_id', 'visit_number')) %>%
left_join(covid_tt, by = c('patient_id', 'visit_number')) %>%
left_join(covid_vaccine, by = c('patient_id', 'visit_number')) %>%
left_join(alcohol, by = c('patient_id', 'visit_number')) %>%
left_join(cancer, by = c('patient_id', 'visit_number')) %>%
left_join(CVD_ctv3, by = c('patient_id', 'visit_number')) %>%
left_join(CVD_snomed, by = c('patient_id', 'visit_number')) %>%
left_join(digestive_disorder, by = c('patient_id', 'visit_number')) %>%
left_join(hiv_aids, by = c('patient_id', 'visit_number')) %>%
left_join(mental_disorder, by = c('patient_id', 'visit_number')) %>%
left_join(metabolic_disorder, by = c('patient_id', 'visit_number')) %>%
left_join(musculoskeletal_ctv3, by = c('patient_id', 'visit_number')) %>%
left_join(musculoskeletal_snomed, by = c('patient_id', 'visit_number')) %>%
left_join(neurological_ctv3, by = c('patient_id', 'visit_number')) %>%
left_join(neurological_snomed, by = c('patient_id', 'visit_number')) %>%
left_join(kidney_disorder, by = c('patient_id', 'visit_number')) %>%
left_join(respiratory_disorder, by = c('patient_id', 'visit_number'))
# TODO
# Put in sense check to remove rows where visit dates are not monotonically
# increasing
# Shouldn't be a problem in the real data but will affect pipeline devlopment
write_csv(cis_long, '../output/input_cis_long.csv')
View(cis_long)
library(tidyverse)
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
df <- read_csv('../output/input_cis_long.csv')
View(df)
colnames(df)
library(tidyverse)
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
cis_long <- read_csv('output/input_cis_long.csv')
cis_long <- cis_long %>%
mutate(CVD = ifelse(CVD_snomed == 1 | CVD_ctv3 == 1, 1, 0),
musculoskeletal = ifelse(musculoskeletal_snomed == 1 | musculoskeletal_ctv3 == 1, 1, 0),
neurological - if_else(neurological_snomed == 1 | neurological_ctv3 == 1, 1, 0)) %>%
select(-CVD_snomed, -CVD_ctv3,
-musculoskeletal_snomed, -musculoskeletal_ctv3,
-neurological_snomed, -neurological_ctv3)
write_csv(cis_long, 'output/input_reconciled.csv')
library(tidyverse)
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
cis_long <- read_csv('output/input_cis_long.csv')
cis_long <- cis_long %>%
mutate(CVD = ifelse(CVD_snomed == 1 | CVD_ctv3 == 1, 1, 0),
musculoskeletal = ifelse(musculoskeletal_snomed == 1 | musculoskeletal_ctv3 == 1, 1, 0),
neurological = if_else(neurological_snomed == 1 | neurological_ctv3 == 1, 1, 0)) %>%
select(-CVD_snomed, -CVD_ctv3,
-musculoskeletal_snomed, -musculoskeletal_ctv3,
-neurological_snomed, -neurological_ctv3)
write_csv(cis_long, 'output/input_reconciled.csv')
